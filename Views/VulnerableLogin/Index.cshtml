@model SqlInjectionDemo.Models.LoginViewModel

@{
    ViewData["Title"] = "Login Vulnerable";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h2>üîì Login Vulnerable a SQL Injection</h2>
                </div>
                <div class="card-body">
                    <div class="alert alert-danger" role="alert">
                        <strong>‚ö†Ô∏è ADVERTENCIA:</strong> Este formulario es intencionalmente vulnerable. 
                        El c√≥digo concatena directamente las entradas del usuario en la consulta SQL.
                    </div>

                    @if (ViewBag.Success == true)
                    {
                        <div class="alert alert-success" role="alert">
                            <h4>‚úÖ @ViewBag.Message</h4>
                            <hr>
                            <h5>Informaci√≥n del usuario:</h5>
                            <pre>@ViewBag.UserInfo</pre>
                        </div>
                    }
                    else if (ViewBag.Success == false)
                    {
                        <div class="alert alert-warning" role="alert">
                            <strong>‚ùå @ViewBag.Message</strong>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(ViewBag.Error))
                    {
                        <div class="alert alert-danger" role="alert">
                            <h5>üíÄ Error SQL (esto ayuda al atacante):</h5>
                            <pre class="mb-0">@ViewBag.Error</pre>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(ViewBag.Query))
                    {
                        <div class="alert alert-info" role="alert">
                            <h5>üìù Consulta SQL ejecutada:</h5>
                            <code>@ViewBag.Query</code>
                        </div>
                    }

                    <form method="post" asp-action="Index">
                        <div class="mb-3">
                            <label for="Username" class="form-label">Usuario</label>
                            <input type="text" class="form-control" id="Username" name="Username" 
                                   value="@Model.Username" placeholder="Ingresa un usuario o un payload de SQL injection">
                        </div>
                        <div class="mb-3">
                            <label for="Password" class="form-label">Contrase√±a</label>
                            <input type="text" class="form-control" id="Password" name="Password" 
                                   value="@Model.Password" placeholder="Ingresa una contrase√±a">
                            <small class="form-text text-muted">
                                Nota: El campo es de tipo "text" para que puedas ver lo que escribes
                            </small>
                        </div>
                        <button type="submit" class="btn btn-danger btn-lg">Iniciar Sesi√≥n</button>
                    </form>

                    <hr class="my-4">

                    <div class="card">
                        <div class="card-header bg-dark text-white">
                            <h5>üéØ Ejemplos de SQL Injection para probar:</h5>
                        </div>
                        <div class="card-body">
                            <h6>1. Bypass de autenticaci√≥n (dejar contrase√±a vac√≠a):</h6>
                            <ul>
                                <li>Usuario: <code>admin' OR '1'='1</code></li>
                                <li>Usuario: <code>admin' --</code></li>
                                <li>Usuario: <code>' OR 1=1 --</code></li>
                            </ul>

                            <h6>2. Obtener todos los usuarios:</h6>
                            <ul>
                                <li>Usuario: <code>' OR '1'='1</code></li>
                            </ul>

                            <h6>3. Comentar el resto de la query:</h6>
                            <ul>
                                <li>Usuario: <code>admin'--</code></li>
                                <li>Usuario: <code>user1'#</code></li>
                            </ul>

                            <h6>Explicaci√≥n:</h6>
                            <p class="mb-0">
                                El c√≥digo vulnerable construye la query as√≠: 
                                <code>SELECT * FROM Users WHERE Username = '<strong>[TU_INPUT]</strong>' AND Password = '<strong>[TU_PASSWORD]</strong>'</code>
                                <br><br>
                                Si ingresas <code>admin' OR '1'='1</code> como usuario, la query se convierte en:
                                <br>
                                <code>SELECT * FROM Users WHERE Username = 'admin' OR '1'='1' AND Password = ''</code>
                                <br><br>
                                Como <code>'1'='1'</code> siempre es verdadero, la condici√≥n se cumple y accedes sin contrase√±a.
                            </p>
                        </div>
                    </div>

                    <div class="mt-3">
                        <a href="@Url.Action("Index", "Home")" class="btn btn-secondary">
                            ‚Üê Volver al inicio
                        </a>
                        <a href="@Url.Action("Index", "SecureLogin")" class="btn btn-success">
                            Ver versi√≥n segura ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
