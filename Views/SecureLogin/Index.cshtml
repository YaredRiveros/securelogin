@model SqlInjectionDemo.Models.LoginViewModel

@{
    ViewData["Title"] = "Login Seguro";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h2>üîê Login Seguro (Consultas Parametrizadas)</h2>
                </div>
                <div class="card-body">
                    <div class="alert alert-success" role="alert">
                        <strong>‚úÖ SEGURO:</strong> Este formulario utiliza consultas parametrizadas. 
                        Los par√°metros son tratados como valores literales, no como c√≥digo SQL.
                    </div>

                    @if (ViewBag.Success == true)
                    {
                        <div class="alert alert-success" role="alert">
                            <h4>‚úÖ @ViewBag.Message</h4>
                            <hr>
                            <h5>Informaci√≥n del usuario:</h5>
                            <pre>@ViewBag.UserInfo</pre>
                        </div>
                    }
                    else if (ViewBag.Success == false)
                    {
                        <div class="alert alert-warning" role="alert">
                            <strong>‚ùå @ViewBag.Message</strong>
                            <p class="mb-0 mt-2">
                                <small>Nota: Los intentos de SQL Injection son tratados como texto literal y no funcionan aqu√≠.</small>
                            </p>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(ViewBag.Query))
                    {
                        <div class="alert alert-info" role="alert">
                            <h5>üìù Consulta SQL parametrizada:</h5>
                            <code>@ViewBag.Query</code>
                            <p class="mt-2 mb-0">
                                <small>Los valores se pasan como par√°metros (@@username, @@password) que son escapados autom√°ticamente.</small>
                            </p>
                        </div>
                    }

                    <form method="post" asp-action="Index">
                        <div class="mb-3">
                            <label for="Username" class="form-label">Usuario</label>
                            <input type="text" class="form-control" id="Username" name="Username" 
                                   value="@Model.Username" placeholder="Ingresa un usuario">
                        </div>
                        <div class="mb-3">
                            <label for="Password" class="form-label">Contrase√±a</label>
                            <input type="text" class="form-control" id="Password" name="Password" 
                                   value="@Model.Password" placeholder="Ingresa una contrase√±a">
                            <small class="form-text text-muted">
                                Nota: El campo es de tipo "text" para que puedas ver lo que escribes
                            </small>
                        </div>
                        <button type="submit" class="btn btn-success btn-lg">Iniciar Sesi√≥n</button>
                    </form>

                    <hr class="my-4">

                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5>üõ°Ô∏è ¬øPor qu√© es seguro?</h5>
                        </div>
                        <div class="card-body">
                            <h6>Diferencia clave en el c√≥digo:</h6>
                            
                            <div class="mb-3">
                                <strong>‚ùå C√≥digo Vulnerable:</strong>
                                <pre class="bg-light p-2"><code>string query = $"SELECT * FROM Users WHERE Username = '{{username}}' AND Password = '{{password}}'";
command.ExecuteReader();</code></pre>
                            </div>

                            <div class="mb-3">
                                <strong>‚úÖ C√≥digo Seguro:</strong>
                                <pre class="bg-light p-2"><code>string query = "SELECT * FROM Users WHERE Username = @@username AND Password = @@password";
command.Parameters.AddWithValue("@@username", username);
command.Parameters.AddWithValue("@@password", password);
command.ExecuteReader();</code></pre>
                            </div>

                            <h6>Protecci√≥n:</h6>
                            <ul>
                                <li>Los par√°metros se tratan como <strong>valores literales</strong>, no como c√≥digo SQL</li>
                                <li>Caracteres especiales como comillas son escapados autom√°ticamente</li>
                                <li>Intenta <code>admin' OR '1'='1</code> aqu√≠: ser√° buscado como texto literal</li>
                                <li>No se muestran detalles de errores SQL al usuario</li>
                            </ul>

                            <h6>Prueba t√∫ mismo:</h6>
                            <p class="mb-0">
                                Intenta los mismos ataques que funcionaron en el login vulnerable. 
                                Ver√°s que aqu√≠ simplemente dir√° "Credenciales incorrectas" porque busca 
                                un usuario llamado literalmente <code>admin' OR '1'='1</code>, que no existe.
                            </p>
                        </div>
                    </div>

                    <div class="mt-3">
                        <a href="@Url.Action("Index", "Home")" class="btn btn-secondary">
                            ‚Üê Volver al inicio
                        </a>
                        <a href="@Url.Action("Index", "VulnerableLogin")" class="btn btn-danger">
                            Ver versi√≥n vulnerable ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
